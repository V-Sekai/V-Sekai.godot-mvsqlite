Import("env")
import os
import subprocess

subprocess.run(["cargo", "build", "--release"], cwd="thirdparty/mvsqlite/mvsqlite")

env.Append(LIBPATH=["#modules/mvsqlite/thirdparty/mvsqlite/target/release"])
env.Append(CPPPATH=["src", "#modules/mvsqlite/src", "#modules/mvsqlite"])
env.Append(LIBPATH=["thirdparty/spmemvfs", "thirdparty/sqlite"])
env.Prepend(LIBS=["mvsqlite"])

env_thirdparty = env.Clone()
env_thirdparty.disable_warnings()
env_thirdparty.Append(CPPDEFINES=[("SQLITE_ENABLE_RBU", 1)])
env_thirdparty.Append(CPPDEFINES=[("SQLITE_USE_URI", 1)])
env_thirdparty.Append(CPPDEFINES=["SQLITE_ENABLE_JSON1"])

env_thirdparty.add_source_files(env_thirdparty.modules_sources, "thirdparty/sqlite/*.c")
env_thirdparty.add_source_files(env_thirdparty.modules_sources, "thirdparty/spmemvfs/*.c")

env.add_source_files(env.modules_sources, "src/*.cpp")
env.add_source_files(env.modules_sources, "*.cpp")
